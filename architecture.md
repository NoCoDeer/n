# Архитектура проекта Nokri

## 1. Обзор

Проект состоит из двух основных компонентов:

*   **Тема WordPress `nokri`**: Отвечает за внешний вид, шаблоны страниц, подключение стилей и скриптов.
*   **Плагин `nokri_framework`**: Реализует основную бизнес-логику, включая управление вакансиями, пользователями, пакетами и настройками.

Такое разделение является хорошей практикой в разработке для WordPress, так как позволяет отделить представление от логики.

## 2. Компоненты

### 2.1. Тема `nokri`

*   **`functions.php`**: Точка входа темы. Подключает все необходимые файлы, регистрирует хуки, стили, скрипты, виджеты и меню.
*   **`inc/`**: Содержит основную логику темы:
    *   `theme_settings.php`: Настройки темы.
    *   `widgets.php`: Регистрация виджетов.
    *   `nav.php`: Регистрация меню.
    *   `utilities.php`, `utilities-custom.php`: Вспомогательные функции.
    *   `options-init.php`: Инициализация опций Redux.
    *   `theme-shortcodes/`: Логика шорткодов и их классов.
*   **`template-parts/`**: Шаблоны для различных частей сайта (хедер, футер, карточки вакансий, профили и т.д.).
*   **`page-*.php`**: Кастомные шаблоны страниц (поиск, публикация вакансии и т.д.).
*   **`single-job_post.php`**: Шаблон для отображения одной вакансии.
*   **`tgm/`**: Управление зависимостями от плагинов через TGM Plugin Activation.
*   **`woocommerce/`**: Шаблоны для интеграции с WooCommerce.

### 2.2. Плагин `nokri_framework`

*   **`index.php`**: Точка входа плагина. Содержит заголовок плагина и подключает все остальные файлы.
*   **`functions.php`**: Содержит основную логику плагина: хуки, фильтры, обработку форм, AJAX-запросы и т.д.
*   **`cpt/`**: Регистрация кастомных типов записей (Custom Post Types):
    *   `job-board.php`: Регистрирует CPT `job_post` и связанные с ним таксономии (категории, навыки, типы занятости и т.д.).
    *   `custom-feilds.php`: Управление кастомными полями.
*   **`user_profile/`**: Функционал, связанный с профилями пользователей (кандидатов и работодателей).
*   **`includes/`**: Вспомогательные модули:
    *   `emails.php`: Шаблоны и логика отправки email-уведомлений.
    *   `helpers.php`: Вспомогательные функции.
    *   `woocommerce.php`: Интеграция с WooCommerce для платных пакетов.
    *   `api.php`: Вероятно, для мобильного приложения или внешней интеграции.
*   **`redux-framework/`**, **`redux-extensions/`**: Фреймворк Redux для создания панели настроек.
*   **`job_post/`**: Логика, связанная с публикацией и управлением вакансиями.
*   **`tcpdf/`**: Библиотека для генерации PDF.

## 3. Взаимодействие и зависимости

*   Тема `nokri` **жестко зависит** от плагина `nokri_framework`. Без него сайт будет неработоспособен.
*   Плагин `nokri_framework` предоставляет основной функционал, а тема `nokri` — его отображение.
*   Настройки из панели Redux (управляемой плагином) используются как в плагине, так и в теме для управления поведением и внешним видом сайта.
*   Тема и плагин активно используют хуки (actions и filters) для взаимодействия. Например, плагин может добавлять свои элементы на страницы, используя хуки темы.

## 4. Ключевые хуки и фильтры (Предварительный анализ)

*   **Actions**:
    *   `after_setup_theme`: В `nokri/functions.php` для инициализации темы.
    *   `wp_enqueue_scripts`: В `nokri/functions.php` для подключения стилей и скриптов.
    *   `tgmpa_register`: В `nokri/tgm/tgm-init.php` для регистрации необходимых плагинов.
    *   `init`: Используется в плагине для регистрации CPT и таксономий.
    *   `wp_ajax_*`, `wp_ajax_nopriv_*`: Вероятно, используются в `nokri_framework/functions.php` для обработки AJAX-запросов (например, фильтрация вакансий, отправка форм).
*   **Filters**:
    *   `the_content`: Используется для модификации содержимого записей.
    *   `pre_get_posts`: Используется для изменения основного запроса WordPress (например, для фильтрации вакансий на странице архива).

## 5. Обработка данных

*   **Формы**: Обработка форм (регистрация, вход, публикация вакансии) происходит в `nokri_framework`. Логика, вероятно, находится в `nokri_framework/functions.php` и `nokri_framework/job_post/`.
*   **AJAX**: AJAX-запросы используются для динамического обновления контента без перезагрузки страницы (фильтры, поиск, подгрузка вакансий). Обработчики находятся в `nokri_framework/functions.php`.
*   **Настройки темы**: Хранятся в базе данных в виде сериализованного массива в таблице `wp_options` (опция `nokri`). Управляются через Redux Framework.

## 6. Блок-схема (упрощенная)

\`\`\`
[Пользователь] -> [Браузер]

[Браузер] -> [WordPress Core]

[WordPress Core] -> [Тема "nokri"]
    - functions.php (Инициализация)
    - Шаблоны (template-parts, page-*.php)
    - Стили и скрипты (CSS, JS)

[WordPress Core] -> [Плагин "nokri_framework"]
    - index.php (Инициализация)
    - CPT и таксономии (cpt/)
    - Логика (functions.php, includes/)
    - Настройки (Redux Framework)

[Тема "nokri"] <--> [Плагин "nokri_framework"] (через хуки и функции)

[Плагин "nokri_framework"] <--> [База данных]
    - wp_posts, wp_postmeta (Вакансии, страницы)
    - wp_users, wp_usermeta (Пользователи)
    - wp_options (Настройки темы)
    - Кастомные таблицы (если есть)
\`\`\`